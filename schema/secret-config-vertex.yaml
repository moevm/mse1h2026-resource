vertex_type: "SecretConfig"

required_fields:

  id:
    type: string
    format: "urn:{provider}:{kind}:{namespace}/{name}"
    examples:
      - "urn:kubernetes:secret:payments/db-credentials"
      - "urn:aws:secretsmanager:us-east-1:123456789:secret:prod/db-password"
      - "urn:vault:secret:secret/data/payments/stripe-key"

  name:
    type: string
    sources:
      kubernetes: "metadata.name"
      aws_secrets_manager: "Name"
      terraform: "resource.name"
      vault: "path (последний сегмент)"
      gitlab_ci: "variable.key"
      argocd: "spec.source.plugin.env[].name"

  kind:
    type: enum
    values: ["secret", "config", "variable", "parameter"]

  provider:
    type: enum
    values: ["kubernetes", "aws_secrets_manager", "aws_ssm", "azure_keyvault",
             "gcp_secret_manager", "hashicorp_vault", "gitlab_ci", "argocd",
             "terraform", "kong"]

  namespace:
    type: string
    sources:
      kubernetes: "metadata.namespace"
      aws: "region (из ARN)"
      vault: "mount path"

  secret_type:
    type: string
    sources:
      kubernetes: "Secret.type (Opaque, kubernetes.io/tls, etc.)"
      aws_ssm: "type (String, StringList, SecureString)"
      vault: "engine type (kv-v2, transit, database)"

  is_sensitive:
    type: boolean
    derivation: "kind == 'secret' → true; kind == 'config' → false"

  data_keys:
    type: list[string]
    description: "Ключи данных БЕЗ значений"

  discovered_at:
    type: datetime
    format: "ISO 8601 (UTC)"

  source_system:
    type: string

  labels:
    type: map[string, string]

unified_metrics:

  access_rate:
    key: "secret_config.access_rate"
    type: float
    unit: "requests/sec"
    sources:
      prometheus: "rate(apiserver_request_total{resource='secrets', verb='get'}[5m])"
      vault: "vault.route.read.{mount}.count"

  last_accessed_at:
    key: "secret_config.last_accessed_at"
    type: datetime
    format: "ISO 8601 (UTC)"
    sources:
      aws_secrets_manager: "LastAccessedDate"

  last_rotated_at:
    key: "secret_config.last_rotated_at"
    type: datetime
    format: "ISO 8601 (UTC)"
    sources:
      aws_secrets_manager: "LastRotatedDate"
      vault: "lease creation timestamp"

  last_modified_at:
    key: "secret_config.last_modified_at"
    type: datetime
    format: "ISO 8601 (UTC)"
    sources:
      kubernetes: "metadata.managedFields[].time"
      aws_secrets_manager: "LastChangedDate"

  resource_version:
    key: "secret_config.resource_version"
    type: string
    sources:
      kubernetes: "metadata.resourceVersion"
      prometheus: "kube_secret_metadata_resource_version"

  rotation_enabled:
    key: "secret_config.rotation_enabled"
    type: boolean
    sources:
      aws_secrets_manager: "RotationEnabled"
      vault: "lease TTL > 0"

  consuming_services_count:
    key: "secret_config.consuming_services_count"
    type: integer
    derivation: "count of edges (authenticatesvia | dependson) to this vertex"

  immutable:
    key: "secret_config.immutable"
    type: boolean
    sources:
      kubernetes: "Secret.immutable / ConfigMap.immutable"

  encryption_type:
    key: "secret_config.encryption_type"
    type: string
    sources:
      aws_secrets_manager: "KmsKeyId"
      vault: "transit key algorithm"